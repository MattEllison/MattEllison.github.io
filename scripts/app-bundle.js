var __decorate=this&&this.__decorate||function(e,t,i,o){var n,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,o);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,i,a):n(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};define("app",["require","exports","aurelia-dependency-injection","./resources/service/blobStorage","./resources/service/visionapi"],function(e,t,i,o,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){this.blobStorage=e,this.visionAPI=t,this.pictures=new Array}return e.prototype.attached=function(){var e=this;this.blobStorage.GetPictures().then(function(t){console.log("Got pics",t),t.forEach(function(t){e.blobStorage.GetBlobCaption(t.filename).then(function(i){console.log("Caption",i),t.caption=i,e.pictures.push(t)})})})},e=__decorate([i.autoinject,__metadata("design:paramtypes",[o.BloblStorage,n.VisionApi])],e)}();t.App=r}),define("environment",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={debug:!1,testing:!1}}),define("main",["require","exports","./environment"],function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.configure=function(e){e.use.standardConfiguration().feature("resources"),i.default.debug&&e.use.developmentLogging(),i.default.testing&&e.use.plugin("aurelia-testing"),e.start().then(function(){return e.setRoot()})}}),define("resources/index",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.configure=function(e){}}),define("Models/Picture",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.prototype.isNotCat=function(){return!this.caption.toLocaleLowerCase().includes("cat")},e}();t.Picture=i}),define("Models/VisionResponse",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){return function(e){this.caption=e.description.captions[0].text,this.name=this.caption=e.description.captions[0].text}}();t.VisionResponse=i});var __decorate=this&&this.__decorate||function(e,t,i,o){var n,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,o);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,i,a):n(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};define("resources/elements/form-upload",["require","exports","./../service/visionapi","aurelia-dependency-injection","./../service/blobStorage","aurelia-framework","aurelia-binding"],function(e,t,i,o,n,r,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){this.blobStorage=e,this.visionAPI=t}return e.prototype.filedropped=function(e){e.preventDefault(),this.dragging=!1,this.files=e.dataTransfer.files,this.Submit()},e.prototype.dragOver=function(e){e.preventDefault(),this.dragging=!0},e.prototype.Submit=function(){var e=this;this.pictureloading=!0,this.blobStorage.SavePicture(this.files[0]).then(function(t){e.visionAPI.processImage(t.url).then(function(i){t.caption=i.caption,e.blobStorage.updateMetaDataForPicture(t).then(function(t){e.pictures.push(t),e.pictureloading=!1})})})},__decorate([r.bindable({defaultBindingMode:a.bindingMode.twoWay}),__metadata("design:type",Object)],e.prototype,"pictureloading",void 0),__decorate([r.bindable({defaultBindingMode:a.bindingMode.twoWay}),__metadata("design:type",Object)],e.prototype,"pictures",void 0),e=__decorate([o.autoinject,__metadata("design:paramtypes",[n.BloblStorage,i.VisionApi])],e)}();t.FormUpload=s});var __decorate=this&&this.__decorate||function(e,t,i,o){var n,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,o);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,i,a):n(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};define("resources/elements/uploaded-picture",["require","exports","aurelia-binding","./../service/blobStorage","aurelia-framework"],function(e,t,i,o,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.blobStorage=e}return e.prototype.DeleteImage=function(e){var t=this;this.blobStorage.DeleteImage(e).then(function(){var i=t.pictures.indexOf(e);t.pictures.splice(i,1)})},__decorate([n.bindable,__metadata("design:type",Object)],e.prototype,"pic",void 0),__decorate([n.bindable({defaultBindingMode:i.bindingMode.twoWay}),__metadata("design:type",Object)],e.prototype,"pictures",void 0),e=__decorate([n.autoinject,__metadata("design:paramtypes",[o.BloblStorage])],e)}();t.UploadedPicture=r});var __decorate=this&&this.__decorate||function(e,t,i,o){var n,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,o);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,i,a):n(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};define("resources/service/blobStorage",["require","exports","aurelia-dependency-injection","./../../Models/Picture","aurelia-http-client"],function(e,t,i,o,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.httpClient=e,this.pictureContainer="https://catstorageorix.blob.core.windows.net/temp",this.sharedKeyInfo="sv=2017-04-17&ss=bfqt&srt=sco&sp=rwdlacup&se=2017-11-24T20:50:05Z&st=2017-11-04T12:50:05Z&spr=https&sig=lTzCFbApWqiRXlCJ6RHSim9BP2GsYMucxtVGxssxfWg%3D"}return e.prototype.SavePicture=function(e){var t=this;return this.httpClient.configure(function(e){e.withHeader("x-ms-blob-type","BlockBlob")}),this.httpClient.put(this.pictureContainer+"/"+e.name+"?"+this.sharedKeyInfo,e).then(function(i){var n=new o.Picture;return n.filename=e.name,n.url=t.pictureContainer+"/"+e.name,n})},e.prototype.updateMetaDataForPicture=function(e){console.log("Meta data update",e);var t=(new n.HttpClient).configure(function(e){e.withHeader("x-ms-blob-type","BlockBlob")});return console.log("Vision response",e),t.createRequest(this.pictureContainer+"/"+e.filename+"?comp=metadata&"+this.sharedKeyInfo).withHeader("x-ms-meta-caption",e.caption).asPut().send().then(function(){return e})},e.prototype.GetPictures=function(){var e=this;this.httpClient.configure(function(e){e.withHeader("Content-Type","application/json")});var t=this.pictureContainer+"?restype=container&comp=list&"+this.sharedKeyInfo;return console.log("Container Emails",t),this.httpClient.get(t).then(function(t){var i=new Array;console.log("Getting Pics",t);var n=(new DOMParser).parseFromString(t.response,"text/xml");console.log(n);for(var r=n.getElementsByTagName("Blob"),a=0;a<r.length;a++){console.log("Blob",r[a]);var s=r[a].getElementsByTagName("Name")[0].textContent;console.log("Name",s);var c=new o.Picture;c.caption=s,c.name=s,c.url=e.pictureContainer+"/"+s,c.filename=s,i.push(c)}return i})},e.prototype.GetBlobCaption=function(e){return console.log("Blob url ",this.pictureContainer+"/"+e+"?"+this.sharedKeyInfo),this.httpClient.get(this.pictureContainer+"/"+e+"?comp=metadata&"+this.sharedKeyInfo).then(function(e){return console.log("Caption result",e),"object"==typeof e.headers.headers["x-ms-meta-caption"]?e.headers.headers["x-ms-meta-caption"].value:""})},e.prototype.DeleteImage=function(e){return this.httpClient.delete(e.url+"?"+this.sharedKeyInfo)},e=__decorate([i.autoinject,__metadata("design:paramtypes",[n.HttpClient])],e)}();t.BloblStorage=r});var __decorate=this&&this.__decorate||function(e,t,i,o){var n,r=arguments.length,a=r<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,o);else for(var s=e.length-1;s>=0;s--)(n=e[s])&&(a=(r<3?n(a):r>3?n(t,i,a):n(t,i))||a);return r>3&&a&&Object.defineProperty(t,i,a),a},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};define("resources/service/visionapi",["require","exports","./../../Models/VisionResponse","aurelia-http-client","aurelia-framework"],function(e,t,i,o,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){var t=this;this.httpClient=e,this.subscriptionKey="311f1c6de3f946e68713e6ca28c580d7",this.azureVisionAnalyzerAPI="https://westcentralus.api.cognitive.microsoft.com/vision/v1.0/analyze?visualFeatures=description",this.httpClient.configure(function(e){e.withHeader("Ocp-Apim-Subscription-Key",t.subscriptionKey)})}return e.prototype.processImage=function(e){return console.log("Processing image",e),this.httpClient.post(this.azureVisionAnalyzerAPI,{url:e}).then(function(e){return console.log("I did get a result",e),new i.VisionResponse(JSON.parse(e.response))})},e=__decorate([n.autoinject,__metadata("design:paramtypes",[o.HttpClient])],e)}();t.VisionApi=r}),define("text!app.html",["module"],function(e){e.exports='<template><require from="./resources/elements/form-upload"></require><require from="./resources/elements/uploaded-picture"></require><h1 style="text-align:center">Cat Verification App</h1><form-upload pictures.bind="pictures" pictureloading.bind="pictureloading"></form-upload><div id="pictures"><div class="picture" repeat.for="pic of pictures"><uploaded-picture pictures.bind="pictures" pic.bind="pic"></uploaded-picture></div><div class="picture" if.bind="pictureloading"><img src="../loading.gif" alt=""></div></div><style>#pictures{display:flex;flex-wrap:wrap}#pictures .picture{padding:10px;width:250px}</style></template>'}),define("text!resources/elements/form-upload.html",["module"],function(e){e.exports='<template><form class="box has-advanced-upload" dragover.trigger="dragOver($event)" dragleave.trigger="dragging = false" drop.trigger="filedropped($event)"><div class="box__input ${dragging ? \'dragging\':\'\'}"><input change.delegate="Submit()" class="box__file" type="file" name="file" id="file" files.bind="files" single><label for="file"><i class="fa fa-upload fa-5x"></i><div if.bind="dragging">Let go to upload!</div><div else><div><strong>Click here to upload</strong> <span class="box__dragndrop">or drag it here</span></div></div></label></div></form><style>.box__file{display:none}.box__input{background-color:#fff;outline:2px dashed #000;padding:50px;text-align:center}.box__input.dragging{background-color:#f0f8ff}label{font-family:\'Trebuchet MS\',\'Lucida Sans Unicode\',\'Lucida Grande\',\'Lucida Sans\',Arial,sans-serif;font-size:200%;cursor:pointer}label i{opacity:.2}</style></template>'}),define("text!resources/elements/uploaded-picture.html",["module"],function(e){e.exports='<template class.bind="pic.isNotCat() ? \'IsNotCat\':\'IsCat\'"><div class="Delete"><a click.delegate="DeleteImage(pic)" href="#" style="float:right">Delete</a></div><div><div><img class="pic" width="250px" src.bind="pic.url"> <img class="wrong" if.bind="pic.isNotCat()" width="250px" src="../../../wrong.png"></div><div class="caption">${pic.caption}</div></div><style if.bind="pic.isNotCat">.IsNotCat .Delete{padding-bottom:20px}.IsNotCat .pic{position:absolute}.IsNotCat img{position:relative;opacity:.4;height:150px}.IsNotCat .caption{padding-top:20px}</style></template>'});
